# 火车票候补系统 - Web前端

## 项目简介

这是一个基于 **Vue 3** 开发的火车票候补购票系统前端界面，提供了直观、美观的用户交互体验。

## 功能特性

### 核心功能

1. **车次信息查询**
   - 实时显示车次信息（车次号、路线、日期）
   - 动态显示余票数量
   - 一键刷新余票信息

2. **购票功能**
   - 输入乘客信息（ID、姓名）
   - 直接购买车票（有余票时）
   - 购票确认对话框

3. **候补功能**
   - 无票时可选择加入候补队列
   - 显示候补订单号和排队位置
   - 候补确认对话框（模拟支付）

4. **候补订单管理**
   - 查看我的候补订单列表
   - 实时显示排队位置
   - 订单状态跟踪（等待中/已兑现/已失败）
   - 根据订单号查询候补状态

5. **退票功能**
   - 退票操作
   - 自动触发候补队列兑现
   - 退票确认对话框

6. **系统消息**
   - 实时显示操作结果
   - 消息分类（成功/错误/警告/信息）
   - 消息时间戳

## 技术栈

- **Vue 3**: 渐进式JavaScript框架
- **原生JavaScript**: 无需构建工具
- **CSS3**: 现代化样式设计
- **Font Awesome**: 图标库
- **响应式设计**: 支持移动端和桌面端

## 项目结构

```
web/
├── index.html                 # 主HTML文件
├── app.js                     # Vue应用逻辑
├── style.css                  # 样式文件
├── diagram.html               # 设计图表页面
├── diagram.css                # 图表样式文件
├── README.md                  # 前端说明文档
├── BACKEND_DESIGN.md          # 后端设计文档
├── FRONTEND_DESIGN.md         # 前端设计文档
├── DESIGN_DOCUMENT.md         # 完整设计文档（备份）
├── 图表说明.md                # 图表使用指南
├── 文档重组说明.md            # 文档重组说明
└── 更新日志_图表功能.md       # 图表功能更新日志
```

## 设计文档

### 📊 可视化设计图表
**推荐查看方式**：打开主页面后，点击右上角"设计图表"按钮，或直接打开 `diagram.html`

**包含内容**：
- 类模型图：展示数据关系
- 购票流程活动图
- 候补功能活动图
- 退票与兑现活动图
- 查询候补活动图
- 状态转换图

### 📄 文本设计文档

**前端设计文档**: `FRONTEND_DESIGN.md`（本目录）
- 适用对象：前端开发人员
- 主要内容：Vue架构、UI/UX设计、交互设计、动画效果、响应式设计

**后端设计文档**: `../BACKEND_DESIGN.md`（主目录）
- 适用对象：后端开发人员
- 主要内容：数据模型、业务流程、并发控制、网络协议、性能优化

**其他文档**:
- **用户手册**: `用户手册.md` - ⭐ 完整的使用指南（推荐）
- **图表说明**: `图表说明.md` - 可视化图表使用指南
- **文档索引**: `文档索引.md` - 快速查找文档

**主目录文档**:
- **完整设计文档**: `../DESIGN_DOCUMENT.md` - 原始完整版设计文档
- **并发测试说明**: `../并发测试说明.md` - 并发测试指南
- **文档重组说明**: `../文档重组说明.md` - 文档拆分说明
- **文档整理记录**: `../文档整理记录.md` - 文档整理记录

## 使用说明

### 1. 启动后端服务器

首先需要启动Go后端服务器：

```bash
cd ../server
go run main.go
```

服务器将在 `localhost:8080` 启动。

### 2. 打开前端页面

直接在浏览器中打开 `index.html` 文件：

```bash
# Windows
start index.html

# macOS
open index.html

# Linux
xdg-open index.html
```

或者使用本地HTTP服务器：

```bash
# 使用Python
python -m http.server 8000

# 使用Node.js
npx http-server
```

然后在浏览器访问 `http://localhost:8000`

### 3. 操作流程

#### 查询余票
1. 页面加载后自动连接服务器
2. 自动查询车次信息和余票
3. 可点击"刷新余票"按钮更新信息

#### 购买车票
1. 输入乘客ID和姓名
2. 点击"购买车票"按钮
3. 确认购票信息
4. 如果有余票，购票成功
5. 如果无余票，提示加入候补

#### 加入候补
1. 输入乘客信息
2. 点击"加入候补"按钮
3. 确认候补信息（模拟支付）
4. 系统生成候补订单号
5. 显示排队位置

#### 查询候补状态
1. 在"订单号"输入框输入订单号
2. 点击"查询"按钮
3. 查看订单状态和排队位置

#### 退票操作
1. 点击"退票"按钮
2. 确认退票
3. 如有候补订单，自动为第一位兑现

## 界面说明

### 车次信息卡片
- 显示车次号、路线、日期
- 余票数量（绿色表示有票，红色表示无票）
- 刷新按钮

### 操作面板
- 乘客信息输入
- 购票、候补、退票按钮
- 订单查询功能

### 我的候补订单
- 订单列表展示
- 订单状态标签
- 排队位置显示
- 订单详细信息

### 系统消息
- 操作结果提示
- 消息分类显示
- 时间戳记录

## 候补功能流程图

```
┌─────────────┐
│  查询车票    │
└──────┬──────┘
       │
       ▼
┌─────────────┐      有票      ┌─────────────┐
│  是否有余票  │ ──────────────>│  直接购票    │
└──────┬──────┘                └─────────────┘
       │
       │ 无票
       ▼
┌─────────────┐
│ 提示加入候补 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 确认候补订单 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 加入候补队列 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 显示排队位置 │
└──────┬──────┘
       │
       ▼
┌─────────────┐      有退票     ┌─────────────┐
│  等待兑现    │ ──────────────>│  自动购票    │
└─────────────┘                └─────────────┘
```

## 数据模型

### 车次信息 (Train)
```javascript
{
    id: "G1001",           // 车次号
    from: "武汉",          // 出发地
    to: "北京",            // 目的地
    total: 100,           // 总票数
    sold: 50,             // 已售票数
    date: "2024-01-01"    // 日期
}
```

### 乘客信息 (Passenger)
```javascript
{
    id: "ID_001",         // 乘客ID
    name: "张三"          // 乘客姓名
}
```

### 候补订单 (WaitOrder)
```javascript
{
    order_id: "ORDER_1",          // 订单号
    passenger: {                  // 乘客信息
        id: "ID_001",
        name: "张三"
    },
    train_id: "G1001",           // 车次号
    date: "2024-01-01",          // 日期
    create_time: "2024-01-01T10:00:00Z",  // 创建时间
    position: 1,                 // 排队位置
    status: "waiting"            // 状态: waiting/success/failed
}
```

## 消息类型

系统支持以下消息类型：

- `query_ticket`: 查询余票
- `buy_ticket`: 购买车票
- `wait_list`: 加入候补
- `check_wait`: 查询候补位置
- `refund`: 退票

## 状态说明

### 连接状态
- **已连接**: 绿色圆点，表示与服务器连接正常
- **未连接**: 红色圆点，表示与服务器断开连接

### 订单状态
- **等待中** (waiting): 黄色标签，在候补队列中等待
- **已兑现** (success): 绿色标签，候补成功，已购票
- **已失败** (failed): 红色标签，候补失败

### 消息类型
- **成功** (success): 绿色图标，操作成功
- **错误** (error): 红色图标，操作失败
- **警告** (warning): 黄色图标，需要注意
- **信息** (info): 蓝色图标，一般提示

## 注意事项

### 当前实现

由于浏览器安全限制，当前版本使用**模拟数据**进行演示：

1. 连接状态为模拟连接
2. 数据操作在前端本地进行
3. 未实际连接到Go后端服务器

### 实际部署方案

要实现真实的前后端通信，有以下几种方案：

#### 方案1: HTTP API（推荐）

在Go服务器端添加HTTP API接口：

```go
// 添加HTTP服务器
http.HandleFunc("/api/query", handleQuery)
http.HandleFunc("/api/buy", handleBuy)
http.HandleFunc("/api/wait", handleWait)
http.ListenAndServe(":8080", nil)
```

前端使用 `fetch` 或 `axios` 调用API。

#### 方案2: WebSocket

在Go服务器端添加WebSocket支持：

```go
import "github.com/gorilla/websocket"

upgrader := websocket.Upgrader{
    CheckOrigin: func(r *http.Request) bool {
        return true
    },
}
```

前端使用WebSocket连接。

#### 方案3: 代理服务器

创建一个中间代理服务器，将HTTP请求转换为TCP消息。

## 扩展功能建议

1. **用户认证**: 添加登录注册功能
2. **数据持久化**: 保存订单到localStorage
3. **实时通知**: 使用WebSocket实现实时推送
4. **多车次支持**: 支持查询和购买多个车次
5. **支付集成**: 集成真实的支付接口
6. **移动端优化**: 进一步优化移动端体验
7. **国际化**: 支持多语言切换

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 开发说明

本项目使用原生技术栈开发，无需构建工具，便于学习和部署。

### 修改样式

编辑 `style.css` 文件，可以自定义颜色、字体、布局等。

### 修改逻辑

编辑 `app.js` 文件，可以添加新功能或修改现有逻辑。

### 调试

打开浏览器开发者工具（F12），可以查看：
- Console: 查看日志和错误
- Network: 查看网络请求
- Vue DevTools: 查看Vue组件状态

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，欢迎反馈。
