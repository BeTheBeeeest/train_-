# 火车票候补系统 - 用户手册

> 完整的使用指南，从入门到精通

## 📖 目录

1. [快速开始](#快速开始)
2. [界面说明](#界面说明)
3. [功能详解](#功能详解)
   - [车票订单功能](#车票订单功能)
   - [候补订单功能](#候补订单功能)
   - [订单查询功能](#订单查询功能)
4. [常见问题](#常见问题)
5. [高级功能](#高级功能)

---

## 🚀 快速开始

### 第一步：启动后端服务器

**方法1：双击运行（推荐）**
```
双击项目根目录的 start_server.bat
```

**方法2：命令行运行**
```bash
cd server
go run main.go
```

看到以下提示表示服务器启动成功：
```
票务服务器启动，监听端口 8080
```

### 第二步：打开Web界面

**方法1：双击运行（推荐）**
```
双击 web 目录下的 start_web.bat 或 index.html
```

**方法2：浏览器直接打开**
```
在浏览器中打开 web/index.html
```

页面会自动在浏览器中打开！

---

## 🖥️ 界面说明

### 页面布局

```
┌─────────────────────────────────────┐
│         页面头部 - 系统标题          │
│      [设计图表] [连接状态]          │
├─────────────────────────────────────┤
│         车次信息卡片                 │
│   车次号 | 路线 | 日期 | 余票        │
│   [刷新] [售罄测试] [重置]          │
├─────────────────────────────────────┤
│         操作面板                     │
│   乘客ID: [_______]                 │
│   姓名:   [_______]                 │
│   [购票] [候补] [退票] [查询]       │
├─────────────────────────────────────┤
│         我的候补订单                 │
│   订单1 [状态] [位置]               │
│   订单2 [状态] [位置]               │
├─────────────────────────────────────┤
│         系统消息                     │
│   ✓ 成功消息                        │
│   ✗ 错误消息                        │
└─────────────────────────────────────┘
```

### 核心区域

#### 1. 页面头部
- **系统标题**: 火车票候补购票系统
- **设计图表按钮**: 点击查看系统设计图表（类图、活动图等）
- **连接状态**: 显示与服务器的连接状态
  - 🟢 绿色圆点 = 已连接
  - 🔴 红色圆点 = 未连接

#### 2. 车次信息卡片
显示当前车次的详细信息：
- **车次号**: 如 G1001
- **路线**: 出发地 → 目的地
- **日期**: 乘车日期
- **余票**: 当前余票数/总票数
  - 绿色数字 = 有余票
  - 红色数字 = 已售罄

**操作按钮**：
- 🔄 **刷新余票**: 更新最新的余票信息
- ⚗️ **测试售罄**: 将余票归零，用于测试候补功能
- 🔄 **重置系统**: 重置所有数据到初始状态

#### 3. 操作面板
用户操作的核心区域：

**输入框**：
- **乘客ID**: 输入乘客身份证号或ID
- **乘客姓名**: 输入乘客姓名

**操作按钮**：
- 🎫 **购买车票**: 直接购买车票（需有余票）
- 📝 **加入候补**: 无票时加入候补队列
- ↩️ **退票**: 退还已购车票
- 🔍 **查询订单**: 根据订单号查询候补状态

#### 4. 我的候补订单
展示所有候补订单的列表：

**订单卡片显示**：
- 订单号（可点击复制）
- 乘客信息（ID + 姓名）
- 车次信息
- 订单状态：
  - 🟡 **等待中** - 在候补队列中
  - 🟢 **已兑现** - 候补成功，已购票
  - 🔴 **已失败** - 候补失败
- 排队位置：显示在队列中的位置

#### 5. 系统消息
实时显示操作结果和系统提示：

**消息类型**：
- ✅ **成功消息** (绿色) - 操作成功
- ❌ **错误消息** (红色) - 操作失败
- ⚠️ **警告消息** (黄色) - 需要注意
- ℹ️ **信息消息** (蓝色) - 一般提示

每条消息显示：
- 消息图标
- 消息内容
- 时间戳

---

## 🎯 功能详解

### 车票订单功能

#### 功能1：查询余票

**使用场景**：查看当前车次的余票情况

**操作步骤**：
1. 页面加载后自动查询
2. 或点击"刷新余票"按钮手动查询

**显示信息**：
- 车次号：G1001
- 路线：武汉 → 北京
- 余票数量：显示剩余票数
- 总票数：显示车次总票数

**状态提示**：
- 有余票：余票数显示为绿色
- 无余票：余票数显示为红色，提示"无余票"

---

#### 功能2：购买车票

**使用场景**：有余票时直接购买车票

**操作步骤**：

1. **输入乘客信息**
   ```
   乘客ID:   [如: ID_001]
   乘客姓名: [如: 张三]
   ```

2. **点击"购买车票"按钮**

3. **系统验证**
   - 检查信息是否完整
   - 检查是否有余票

4. **购票成功**
   - 显示绿色成功消息
   - 余票数量 -1
   - 表单自动清空

**注意事项**：
- ⚠️ 信息必须填写完整
- ⚠️ 必须有余票才能购买
- ⚠️ 无余票时请选择"加入候补"

**错误提示**：
- "请输入乘客ID" - ID为空
- "请输入乘客姓名" - 姓名为空
- "无余票" - 票已售罄

---

#### 功能3：退票

**使用场景**：退还已购车票，释放票源

**操作步骤**：

1. **点击"退票"按钮**

2. **确认退票**
   - 弹出确认对话框
   - 显示退票提示信息

3. **确认或取消**
   - 点击"确定"执行退票
   - 点击"取消"关闭对话框

4. **退票完成**
   - 余票数量 +1
   - 显示成功消息

**自动兑现机制**：
- 如果有候补订单，退票后自动为队首乘客购票
- 队首订单状态变为"已兑现"
- 其他订单排队位置自动前移
- 显示"候补兑现成功"消息

---

### 候补订单功能

#### 功能4：加入候补

**使用场景**：无余票时，加入候补队列等待购票

**完整流程**：

**步骤1：检查余票**
```
查询车次 → 无余票 → 选择候补
```

**步骤2：输入信息**
```
乘客ID:   [_______]
乘客姓名: [_______]
```

**步骤3：点击"加入候补"**

**步骤4：确认候补**
- 弹出确认对话框
- 显示候补信息：
  ```
  确认加入候补
  ───────────────
  乘客: 张三 (ID_001)
  车次: G1001
  路线: 武汉 → 北京
  日期: 2024-01-01
  
  预计排队位置: 第 X 位
  
  [确定]  [取消]
  ```

**步骤5：支付确认**
- 点击"确定"模拟支付
- 系统生成订单号

**步骤6：候补成功**
- 生成唯一订单号（如：W1732428000001）
- 显示成功消息
- 订单出现在"我的候补订单"列表
- 显示排队位置

**订单信息**：
```
┌────────────────────────────────┐
│ 订单号: W1732428000001          │
│ 乘客: 张三 (ID_001)             │
│ 车次: G1001 武汉→北京           │
│ 状态: 🟡 等待中                 │
│ 位置: 第 1 位                   │
└────────────────────────────────┘
```

**注意事项**：
- ⚠️ 候补不保证一定成功
- ⚠️ 按照先来先服务原则排队
- ⚠️ 有退票时自动为队首乘客购票
- ⚠️ 记住订单号，方便查询

---

#### 功能5：候补等待与兑现

**等待阶段**：
- 订单状态：🟡 **等待中**
- 排队位置：动态显示当前位置
- 可随时查询订单状态

**兑现条件**：
- 有其他乘客退票
- 当前订单在队首位置

**自动兑现流程**：
```
退票发生
    ↓
系统检查候补队列
    ↓
队列不为空？
    ↓ 是
获取队首订单
    ↓
自动购票
    ↓
更新订单状态为"已兑现"
    ↓
从队列移除
    ↓
其他订单位置前移
    ↓
通知用户
```

**兑现成功**：
- 订单状态变为：🟢 **已兑现**
- 显示消息："候补兑现成功！订单 W123... 已成功购票"
- 余票数量不变（退票+1，购票-1）

**状态更新**：
- 其他候补订单位置自动 -1
- 实时刷新候补列表

---

### 订单查询功能

#### 功能6：查询候补状态

**使用场景**：查询特定候补订单的当前状态

**操作步骤**：

1. **输入订单号**
   ```
   订单号: [W1732428000001___]
   ```

2. **点击"查询"按钮**

3. **查看结果**

**查询成功**：
- 订单存在时，该订单会高亮显示
- 自动滚动到订单位置
- 显示完整的订单信息：
  - 订单号
  - 乘客信息
  - 车次信息
  - 当前状态
  - 排队位置（如果等待中）

**订单状态说明**：

```
🟡 等待中
─────────────
- 在候补队列中排队
- 显示当前排队位置
- 等待有退票时自动兑现
- 可继续等待

🟢 已兑现
─────────────
- 候补成功，已自动购票
- 从队列中移除
- 购票完成，可以乘车
- 终态，不可变更

🔴 已失败
─────────────
- 候补失败（可扩展功能）
- 可能原因：超时、取消等
- 终态，不可变更
```

**查询失败**：
- 订单不存在时显示错误消息
- 提示"未找到订单"

**使用提示**：
- 💡 订单号可以从"我的候补订单"列表中获取
- 💡 点击订单号可以复制
- 💡 支持多次查询不同订单

---

## ❓ 常见问题

### Q1: 为什么点击购票按钮没反应？
**A**: 请检查：
- ✅ 是否填写了乘客ID和姓名
- ✅ 是否有余票（余票=0时无法购票）
- ✅ 浏览器控制台是否有错误

### Q2: 如何测试候补功能？
**A**: 按以下步骤操作：
1. 点击"测试售罄"按钮，将余票归零
2. 输入乘客信息，点击"加入候补"
3. 再输入另一个乘客信息，再次加入候补
4. 点击"退票"，观察自动兑现
5. 第一位候补订单会自动变为"已兑现"

### Q3: 候补订单会自动购票吗？
**A**: 是的！当有人退票时：
- 系统自动检查候补队列
- 如队列不为空，自动为队首乘客购票
- 订单状态自动变为"已兑现"
- 其他订单位置自动前移

### Q4: 订单号是什么格式？
**A**: 订单号格式：`W + 时间戳`
- 示例：W1732428000001
- W 表示候补订单（Wait）
- 后面的数字是时间戳，保证唯一性

### Q5: 可以取消候补吗？
**A**: 当前版本不支持取消候补，这是可扩展的功能。
建议功能：
- 添加"取消候补"按钮
- 从队列中移除订单
- 更新其他订单位置

### Q6: 候补有时间限制吗？
**A**: 当前版本没有时间限制，候补订单会一直等待。
可扩展功能：
- 添加超时机制（如24小时）
- 超时后订单状态变为"已失败"
- 自动通知用户

### Q7: 候补队列有长度限制吗？
**A**: 当前版本没有限制，理论上可以无限候补。
实际应用建议：
- 设置队列最大长度
- 达到上限后不允许新增候补

### Q8: 为什么连接状态显示"未连接"？
**A**: 当前版本使用模拟数据，连接状态为模拟状态。
实际部署时：
- 需要实现真实的前后端通信
- 使用WebSocket或HTTP API
- 连接状态会显示真实状态

### Q9: 如何重置系统？
**A**: 点击"重置系统"按钮：
- 余票恢复到初始状态（100）
- 清空所有候补订单
- 清空系统消息
- 刷新页面也可以重置

### Q10: 候补位置会变化吗？
**A**: 会的！位置变化情况：
- 加入队列时：排在最后
- 有人兑现时：前面的人离开，位置-1
- 自己兑现时：从队列移除

---

## 🔧 高级功能

### 测试功能

#### 售罄测试
**用途**：快速测试候补功能
**操作**：点击"测试售罄"按钮
**效果**：余票归零，强制触发候补场景

#### 系统重置
**用途**：恢复初始状态
**操作**：点击"重置系统"按钮
**效果**：
- 余票恢复到100
- 清空所有候补订单
- 清空系统消息

### 并发测试

如果要测试多客户端并发，可以：
1. 在多个浏览器标签页打开系统
2. 同时进行购票或候补操作
3. 观察数据同步情况

**注意**：当前版本使用本地模拟，多标签页数据不会同步。
真实部署时会通过服务器同步所有客户端的数据。

### 数据持久化

**当前**：数据存储在内存中，刷新页面会丢失

**建议扩展**：
- 使用localStorage保存订单
- 连接真实后端数据库
- 实现数据持久化存储

---

## 📞 技术支持

### 浏览器要求
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 移动端支持
✅ 支持响应式设计
✅ 自动适配手机屏幕
✅ 触摸友好的交互

### 开发者工具
按F12打开浏览器开发者工具：
- **Console**: 查看日志和错误
- **Network**: 查看网络请求
- **Vue DevTools**: 查看Vue组件状态

---

## 📚 相关文档

- **[README.md](README.md)** - 项目说明
- **[FRONTEND_DESIGN.md](FRONTEND_DESIGN.md)** - 前端设计文档
- **[diagram.html](diagram.html)** - 可视化设计图表
- **[图表说明.md](图表说明.md)** - 图表使用指南

---

**提示**：本手册持续更新中，如有疑问欢迎反馈！

*最后更新: 2024-11-24*
