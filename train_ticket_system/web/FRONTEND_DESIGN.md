# 火车票候补系统 - 前端设计文档

## 一、系统概述

### 1.1 项目简介
本系统前端采用Vue 3框架开发，实现了现代化的Web用户界面。用户可以通过浏览器进行车票查询、购买、加入候补、查询订单状态等操作。界面美观、交互流畅、响应式设计。

### 1.2 技术栈
- **框架**: Vue 3 (CDN版本)
- **开发语言**: JavaScript (ES6+)
- **样式**: CSS3 + 原生CSS变量
- **图标**: Font Awesome 6.4.0
- **图表**: Mermaid.js (用于设计文档可视化)
- **通信**: 模拟服务器通信（可替换为真实API）

### 1.3 核心特性
- ✅ 响应式设计（支持移动端、平板、桌面端）
- ✅ Vue 3响应式数据管理
- ✅ 实时状态更新
- ✅ 美观的UI设计
- ✅ 流畅的动画效果
- ✅ 完整的错误处理
- ✅ 无需构建工具，开箱即用

## 二、架构设计

### 2.1 Vue组件结构

```
App (根组件)
├── Header (头部导航)
│   ├── Title (系统标题)
│   ├── DiagramLink (设计图表链接)
│   └── ConnectionStatus (连接状态指示器)
│
├── TrainInfo (车次信息展示)
│   ├── TrainDetails (车次详情)
│   ├── TicketCount (余票数量)
│   └── ActionButtons (操作按钮组)
│
├── Operations (操作面板)
│   ├── PassengerForm (乘客信息表单)
│   │   ├── IDInput (ID输入框)
│   │   └── NameInput (姓名输入框)
│   ├── BuyTicketButton (购票按钮)
│   ├── WaitListButton (候补按钮)
│   └── OrderQuery (订单查询)
│
├── WaitQueue (候补队列展示)
│   ├── QueueHeader (队列头部)
│   └── OrderList (订单列表)
│       └── OrderItem (单个订单)
│           ├── OrderInfo (订单信息)
│           ├── PassengerInfo (乘客信息)
│           ├── StatusBadge (状态标签)
│           └── PositionBadge (位置标签)
│
├── Messages (系统消息)
│   └── MessageItem (单条消息)
│       ├── MessageIcon (消息图标)
│       ├── MessageText (消息文本)
│       └── MessageTime (消息时间)
│
└── ConfirmDialog (确认对话框)
    ├── DialogContent (对话框内容)
    ├── ConfirmButton (确认按钮)
    └── CancelButton (取消按钮)
```

### 2.2 数据流设计

```
┌─────────────────────────────────────────────┐
│              用户操作层                      │
│  (点击按钮、输入数据、提交表单)              │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│            Vue事件处理层                     │
│  (methods: buyTicket, addToWaitList, etc.)  │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│           业务逻辑处理层                      │
│  (数据验证、状态检查、业务规则)              │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│           模拟服务器通信层                    │
│  (sendMessage: 模拟发送请求和接收响应)        │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│            Vue数据更新层                     │
│  (reactive data: trainInfo, waitOrders...)  │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│            视图渲染层                         │
│  (DOM更新、动画效果、UI刷新)                 │
└─────────────────────────────────────────────┘
```

### 2.3 状态管理

```javascript
// Vue响应式数据
data() {
    return {
        // 连接状态
        isConnected: false,
        
        // 车次信息
        trainInfo: null,
        
        // 乘客信息
        passenger: {
            id: '',
            name: ''
        },
        
        // 候补订单列表
        waitOrders: [],
        
        // 系统消息列表
        messages: [],
        
        // 查询订单号
        queryOrderId: '',
        
        // 确认对话框
        confirmDialog: {
            show: false,
            title: '',
            message: '',
            onConfirm: null
        }
    }
}
```

## 三、核心功能设计

### 3.1 车票查询功能

**流程图**:
```
用户操作
   │
   ▼
点击"刷新余票"
   │
   ▼
调用queryTicket()
   │
   ▼
发送query_ticket请求
   │
   ▼
接收Train数据
   │
   ▼
更新trainInfo
   │
   ▼
视图自动刷新
   │
   ▼
显示余票信息
```

**实现代码结构**:
```javascript
queryTicket() {
    // 1. 显示加载状态
    // 2. 发送查询请求
    // 3. 接收响应数据
    // 4. 更新trainInfo
    // 5. 显示成功消息
}
```

**UI展示**:
- 车次号（大字体高亮）
- 出发地 → 目的地（带箭头）
- 余票数量（彩色显示，无票时红色警告）
- 刷新按钮

### 3.2 购票功能

**流程图**:
```
用户操作
   │
   ▼
输入乘客信息
   │
   ▼
点击"购买车票"
   │
   ▼
验证信息完整性 ───> 无效 ───> 显示错误提示
   │
  有效
   │
   ▼
检查余票 ───> 无余票 ───> 提示无票
   │
  有余票
   │
   ▼
发送buy_ticket请求
   │
   ▼
更新余票数量
   │
   ▼
显示成功消息
   │
   ▼
清空表单
```

**数据验证**:
- 乘客ID不为空
- 乘客姓名不为空
- 余票数量 > 0

**成功反馈**:
- 绿色成功消息
- 余票数量减1
- 表单自动清空

### 3.3 候补功能

**流程图**:
```
用户操作
   │
   ▼
输入乘客信息
   │
   ▼
点击"加入候补"
   │
   ▼
验证信息 ───> 无效 ───> 显示错误
   │
  有效
   │
   ▼
弹出确认对话框
   │
   ├─> 用户取消 ───> 关闭对话框
   │
   └─> 用户确认
       │
       ▼
   发送wait_list请求
       │
       ▼
   生成订单信息
       │
       ▼
   添加到候补队列
       │
       ▼
   显示订单信息
       │
       ▼
   清空表单
```

**确认对话框设计**:
- 标题："确认加入候补"
- 内容：
  - 乘客信息展示
  - 车次信息展示
  - 排队位置预估
- 按钮：
  - 确认按钮（绿色）
  - 取消按钮（灰色）

**订单展示**:
- 订单号（可复制）
- 乘客信息
- 排队位置（动态更新）
- 订单状态（颜色区分）
  - 黄色：等待中
  - 绿色：已兑现
  - 红色：已失败

### 3.4 订单查询功能

**流程图**:
```
用户操作
   │
   ▼
输入订单号
   │
   ▼
点击"查询订单"
   │
   ▼
验证订单号 ───> 为空 ───> 显示错误
   │
  不为空
   │
   ▼
发送check_wait请求
   │
   ▼
订单存在？
   │
   ├─> 不存在 ───> 显示未找到提示
   │
   └─> 存在
       │
       ▼
   高亮显示订单
       │
       ▼
   滚动到订单位置
       │
       ▼
   显示订单详情
```

**查询结果展示**:
- 订单信息卡片高亮
- 平滑滚动到目标位置
- 显示完整订单信息
- 支持再次查询

### 3.5 退票功能

**流程图**:
```
用户操作
   │
   ▼
点击"退票"按钮
   │
   ▼
弹出确认对话框
   │
   ├─> 用户取消 ───> 关闭对话框
   │
   └─> 用户确认
       │
       ▼
   发送refund请求
       │
       ▼
   余票数量+1
       │
       ▼
   检查候补队列
       │
       ▼
   队列不为空？
       │
       └─> 是
           │
           ▼
       自动兑现队首
           │
           ▼
       更新订单状态
           │
           ▼
       显示兑现消息
           │
           ▼
       更新其他订单位置
```

**自动兑现展示**:
- 显示"候补兑现成功"消息
- 订单状态变为绿色"已兑现"
- 从候补队列移除
- 其他订单位置前移

## 四、UI/UX设计

### 4.1 色彩方案

```css
:root {
    --primary-color: #1890ff;      /* 主色调-蓝色 */
    --success-color: #52c41a;      /* 成功-绿色 */
    --warning-color: #faad14;      /* 警告-橙色 */
    --danger-color: #f5222d;       /* 危险-红色 */
    --info-color: #13c2c2;         /* 信息-青色 */
    --text-color: #333;            /* 主文本 */
    --text-secondary: #666;        /* 次要文本 */
    --border-color: #d9d9d9;       /* 边框 */
    --bg-color: #f0f2f5;           /* 背景 */
    --card-bg: #ffffff;            /* 卡片背景 */
}
```

**色彩使用规则**:
- **主色调**：按钮、链接、重要信息
- **成功色**：购票成功、已兑现状态
- **警告色**：等待中状态、需要注意的信息
- **危险色**：无余票、失败状态、删除操作
- **信息色**：提示信息、辅助说明

### 4.2 布局设计

**桌面端布局 (>768px)**:
```
┌─────────────────────────────────────────┐
│              Header (全宽)               │
├─────────────────────────────────────────┤
│          Container (1200px)             │
│  ┌────────────────────────────────┐    │
│  │      车次信息卡片               │    │
│  └────────────────────────────────┘    │
│  ┌────────────────────────────────┐    │
│  │      操作面板                   │    │
│  └────────────────────────────────┘    │
│  ┌────────────────────────────────┐    │
│  │      候补队列                   │    │
│  └────────────────────────────────┘    │
│  ┌────────────────────────────────┐    │
│  │      系统消息                   │    │
│  └────────────────────────────────┘    │
└─────────────────────────────────────────┘
```

**移动端布局 (<768px)**:
```
┌──────────────────┐
│     Header       │
├──────────────────┤
│   车次信息       │
├──────────────────┤
│   操作面板       │
├──────────────────┤
│   候补队列       │
├──────────────────┤
│   系统消息       │
└──────────────────┘
```

### 4.3 交互设计

**按钮交互**:
- 悬停：背景色加深、轻微上移
- 点击：缩小动画
- 禁用：灰色、不可点击
- 加载：显示加载图标

**表单交互**:
- 聚焦：边框高亮、阴影
- 输入：实时验证
- 错误：红色边框、错误提示
- 成功：绿色边框

**卡片交互**:
- 悬停：阴影加深、轻微上移
- 点击：展开详情
- 动画：淡入、滑入

**对话框交互**:
- 打开：背景遮罩、淡入动画
- 关闭：淡出动画
- 点击遮罩：关闭对话框

### 4.4 响应式设计

**断点设置**:
```css
/* 桌面端 */
@media (min-width: 1200px) {
    .container { max-width: 1200px; }
}

/* 平板 */
@media (max-width: 768px) {
    .header h1 { font-size: 20px; }
    .card { padding: 16px; }
}

/* 手机 */
@media (max-width: 480px) {
    .button-group { flex-direction: column; }
    .btn { width: 100%; }
}
```

**响应式策略**:
- 移动端优先设计
- 弹性布局（Flexbox）
- 自适应字体大小
- 触摸友好的交互

## 五、动画效果设计

### 5.1 页面加载动画

```css
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card {
    animation: fadeInUp 0.6s ease-out;
}
```

### 5.2 状态变化动画

**余票数量变化**:
- 数字放大 → 缩小
- 颜色渐变

**订单状态变化**:
- 背景色渐变
- 图标旋转

**消息提示**:
- 从右侧滑入
- 自动淡出

### 5.3 交互动画

```css
/* 按钮悬停 */
.btn:hover {
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

/* 卡片悬停 */
.card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

/* 连接状态脉动 */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
```

## 六、错误处理设计

### 6.1 输入验证

**前端验证规则**:
```javascript
validatePassenger() {
    if (!this.passenger.id.trim()) {
        this.showMessage('error', '请输入乘客ID');
        return false;
    }
    if (!this.passenger.name.trim()) {
        this.showMessage('error', '请输入乘客姓名');
        return false;
    }
    return true;
}
```

### 6.2 错误提示

**提示方式**:
- 消息列表：顶部显示错误消息
- 表单下方：显示具体错误
- 对话框：显示详细错误信息

**错误类型**:
- 输入错误：红色文字提示
- 网络错误：显示重试按钮
- 业务错误：显示具体原因

### 6.3 异常处理

```javascript
try {
    // 业务逻辑
    await this.sendMessage('buy_ticket', data);
} catch (error) {
    console.error('购票失败:', error);
    this.showMessage('error', '操作失败，请重试');
}
```

## 七、性能优化

### 7.1 Vue响应式优化

**计算属性使用**:
```javascript
computed: {
    remainingTickets() {
        return this.trainInfo 
            ? this.trainInfo.total - this.trainInfo.sold 
            : 0;
    },
    sortedOrders() {
        return [...this.waitOrders].sort((a, b) => 
            a.position - b.position
        );
    }
}
```

### 7.2 列表渲染优化

**使用key属性**:
```html
<div v-for="order in waitOrders" :key="order.orderId">
    <!-- 订单内容 -->
</div>
```

### 7.3 消息列表限制

```javascript
addMessage(type, text) {
    this.messages.unshift({ type, text, time: new Date() });
    if (this.messages.length > 20) {
        this.messages = this.messages.slice(0, 20);
    }
}
```

### 7.4 CSS性能

**使用transform替代position**:
```css
/* 推荐 */
.element {
    transform: translateY(-2px);
}

/* 不推荐 */
.element {
    top: -2px;
}
```

## 八、可访问性设计

### 8.1 语义化HTML

```html
<!-- 使用语义化标签 -->
<header class="header">
<main class="container">
<section class="card">
<button class="btn">
```

### 8.2 键盘导航

- Tab键切换焦点
- Enter键提交表单
- Esc键关闭对话框

### 8.3 屏幕阅读器支持

```html
<button aria-label="查询余票">
    <i class="fas fa-sync-alt" aria-hidden="true"></i>
    刷新余票
</button>
```

## 九、测试建议

### 9.1 功能测试

**测试用例**:
- ✅ 车票查询功能
- ✅ 购票功能（有票/无票）
- ✅ 候补功能（加入/查询）
- ✅ 退票功能（触发兑现）
- ✅ 订单查询功能

### 9.2 兼容性测试

**浏览器**:
- Chrome（推荐）
- Firefox
- Safari
- Edge

**设备**:
- 桌面端（1920x1080, 1366x768）
- 平板（768x1024）
- 手机（375x667, 414x896）

### 9.3 性能测试

**测试指标**:
- 首屏加载时间 < 2s
- 交互响应时间 < 100ms
- 动画帧率 ≥ 60fps

## 十、部署说明

### 10.1 部署方式

**方式一：直接打开**
```bash
# 直接在浏览器中打开
web/index.html
```

**方式二：本地服务器**
```bash
# 使用Python启动
cd web
python -m http.server 8000
```

**方式三：使用启动脚本**
```bash
# Windows
start_web.bat

# 或双击打开index.html
```

### 10.2 配置说明

**修改服务器地址**（如需连接真实后端）:
```javascript
// app.js中修改
const SERVER_URL = 'http://localhost:8080';
```

### 10.3 CDN资源

**Vue 3**:
```html
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
```

**Font Awesome**:
```html
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
```

## 十一、扩展功能建议

### 11.1 用户系统
- 用户注册/登录
- 个人中心
- 历史订单查询

### 11.2 支付系统
- 支付接口集成
- 支付状态跟踪
- 退款处理

### 11.3 通知系统
- 浏览器通知
- 邮件通知
- 短信通知

### 11.4 数据可视化
- 票务统计图表
- 候补队列可视化
- 实时数据看板

## 十二、总结

本前端系统采用Vue 3框架，实现了完整的票务管理界面。系统具有：

✅ **现代化设计**: 美观的UI，流畅的动画
✅ **响应式布局**: 支持各种设备和屏幕
✅ **良好体验**: 直观的操作，清晰的反馈
✅ **易于维护**: 清晰的代码结构，详细的注释
✅ **高性能**: 优化的渲染，快速响应
✅ **易于部署**: 无需构建，开箱即用

系统为用户提供了友好的交互体验，同时也为开发者提供了良好的代码参考。
