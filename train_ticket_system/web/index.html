<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«è½¦ç¥¨å€™è¡¥è´­ç¥¨ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="header">
            <div class="container">
                <h1><i class="fas fa-train"></i> ç«è½¦ç¥¨å€™è¡¥è´­ç¥¨ç³»ç»Ÿ</h1>
                <div class="header-right">
                    <a href="diagram.html" class="btn btn-diagram" title="æŸ¥çœ‹ç³»ç»Ÿè®¾è®¡å›¾">
                        <i class="fas fa-diagram-project"></i> è®¾è®¡å›¾è¡¨
                    </a>
                    <div class="connection-status" :class="{ connected: isConnected, disconnected: !isConnected }">
                        <i class="fas fa-circle"></i>
                        <span>{{ isConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹åŒº -->
        <main class="container">
            <!-- è½¦æ¬¡ä¿¡æ¯å¡ç‰‡ -->
            <section class="card train-info">
                <h2><i class="fas fa-info-circle"></i> è½¦æ¬¡ä¿¡æ¯</h2>
                <div class="train-details" v-if="trainInfo">
                    <div class="info-row">
                        <div class="info-item">
                            <label>è½¦æ¬¡å·ï¼š</label>
                            <span class="train-number">{{ trainInfo.id }}</span>
                        </div>
                        <div class="info-item">
                            <label>æ—¥æœŸï¼š</label>
                            <span>{{ trainInfo.date }}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item route">
                            <i class="fas fa-map-marker-alt"></i>
                            <span class="from">{{ trainInfo.from }}</span>
                            <i class="fas fa-arrow-right"></i>
                            <span class="to">{{ trainInfo.to }}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item tickets">
                            <label>ä½™ç¥¨ï¼š</label>
                            <span class="ticket-count" :class="{ 'no-tickets': remainingTickets === 0 }">
                                {{ remainingTickets }} / {{ trainInfo.total }}
                            </span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-primary" @click="queryTicket">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°ä½™ç¥¨
                        </button>
                        <button class="btn btn-warning" @click="sellOutTickets">
                            <i class="fas fa-flask"></i> æµ‹è¯•å”®ç½„ï¼ˆä½™ç¥¨å½’é›¶ï¼‰
                        </button>
                        <button class="btn btn-secondary" @click="resetSystem">
                            <i class="fas fa-redo"></i> é‡ç½®ç³»ç»Ÿ
                        </button>
                    </div>
                </div>
                <div v-else class="no-data">
                    <p>è¯·å…ˆè¿æ¥æœåŠ¡å™¨å¹¶æŸ¥è¯¢è½¦æ¬¡ä¿¡æ¯</p>
                    <button class="btn btn-primary" @click="connectServer">
                        <i class="fas fa-plug"></i> è¿æ¥æœåŠ¡å™¨
                    </button>
                </div>
            </section>

            <!-- æ“ä½œé¢æ¿ -->
            <section class="card operations">
                <h2><i class="fas fa-cog"></i> æ“ä½œé¢æ¿</h2>
                
                <!-- ä¹˜å®¢ä¿¡æ¯è¾“å…¥ -->
                <div class="form-group">
                    <label for="passengerId">ä¹˜å®¢IDï¼š</label>
                    <input 
                        type="text" 
                        id="passengerId" 
                        v-model="passenger.id" 
                        placeholder="è¯·è¾“å…¥ä¹˜å®¢ID"
                        class="input"
                    >
                </div>
                <div class="form-group">
                    <label for="passengerName">ä¹˜å®¢å§“åï¼š</label>
                    <input 
                        type="text" 
                        id="passengerName" 
                        v-model="passenger.name" 
                        placeholder="è¯·è¾“å…¥ä¹˜å®¢å§“å"
                        class="input"
                    >
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="button-group">
                    <button 
                        class="btn btn-success" 
                        @click="buyTicket"
                        :disabled="!isConnected || !passenger.id || !passenger.name"
                    >
                        <i class="fas fa-ticket-alt"></i> è´­ä¹°è½¦ç¥¨
                    </button>
                    <button 
                        class="btn btn-warning" 
                        @click="addToWaitList"
                        :disabled="!isConnected || !passenger.id || !passenger.name"
                    >
                        <i class="fas fa-clock"></i> åŠ å…¥å€™è¡¥
                    </button>
                    <button 
                        class="btn btn-danger" 
                        @click="refundTicket"
                        :disabled="!isConnected"
                    >
                        <i class="fas fa-undo"></i> é€€ç¥¨
                    </button>
                </div>

                <!-- å¹¶å‘æµ‹è¯•åŒºåŸŸ -->
                <div class="form-group" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                    <label style="font-weight: bold; color: #1890ff;">
                        <i class="fas fa-users"></i> å¹¶å‘æŠ¢ç¥¨æµ‹è¯•
                    </label>
                    <div style="margin-top: 10px;">
                        <label for="concurrentCount">å¹¶å‘å®¢æˆ·ç«¯æ•°é‡ï¼š</label>
                        <input 
                            type="number" 
                            id="concurrentCount" 
                            v-model.number="concurrentCount" 
                            min="1" 
                            max="200"
                            class="input"
                            style="width: 150px; display: inline-block; margin-right: 10px;"
                        >
                        <button 
                            class="btn btn-info" 
                            @click="startConcurrentBuying"
                            :disabled="!isConnected || concurrentCount < 1"
                        >
                            <i class="fas fa-rocket"></i> å¼€å§‹å¹¶å‘æŠ¢ç¥¨
                        </button>
                    </div>
                    <p style="margin-top: 10px; font-size: 12px; color: #666;">
                        æç¤ºï¼šæ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶æŠ¢ç¥¨ï¼Œè§‚å¯Ÿç¥¨æ•°å˜åŒ–å’Œå€™è¡¥é˜Ÿåˆ—
                    </p>
                </div>

                <!-- æŸ¥è¯¢è®¢å• -->
                <div class="form-group" style="margin-top: 20px;">
                    <label for="orderId">
                        <i class="fas fa-search"></i> è®¢å•æŸ¥è¯¢ï¼š
                    </label>
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="orderId" 
                            v-model="checkOrderId" 
                            placeholder="è¾“å…¥è®¢å•å·ï¼ˆTICKET_xxx æˆ– ORDER_xxxï¼‰"
                            class="input"
                        >
                        <button 
                            class="btn btn-info" 
                            @click="checkWaitPosition"
                            :disabled="!isConnected || !checkOrderId"
                        >
                            <i class="fas fa-search"></i> æŸ¥è¯¢è®¢å•
                        </button>
                    </div>
                    <p style="margin-top: 5px; font-size: 12px; color: #666;">
                        ğŸ’¡ æ”¯æŒæŸ¥è¯¢è½¦ç¥¨è®¢å•ï¼ˆTICKET_ï¼‰å’Œå€™è¡¥è®¢å•ï¼ˆORDER_ï¼‰
                    </p>
                </div>
            </section>

            <!-- æˆ‘çš„è½¦ç¥¨ -->
            <section class="card my-tickets">
                <h2><i class="fas fa-ticket-alt"></i> æˆ‘çš„è½¦ç¥¨</h2>
                <div v-if="myTicketOrders.length > 0" class="orders-list">
                    <div 
                        v-for="ticket in myTicketOrders" 
                        :key="ticket.order_id"
                        class="order-item ticket-item"
                    >
                        <div class="order-header">
                            <span class="order-id">{{ ticket.order_id }}</span>
                            <span class="order-status badge-success">
                                å·²å‡ºç¥¨
                            </span>
                        </div>
                        <div class="order-body">
                            <div class="order-info">
                                <p><i class="fas fa-user"></i> {{ ticket.passenger.name }} ({{ ticket.passenger.id }})</p>
                                <p><i class="fas fa-train"></i> {{ ticket.train_id }} - {{ ticket.date }}</p>
                                <p><i class="fas fa-clock"></i> è´­ç¥¨æ—¶é—´: {{ formatTime(ticket.purchase_time) }}</p>
                            </div>
                            <div class="ticket-badge">
                                <i class="fas fa-check-circle" style="font-size: 48px; color: #52c41a;"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else class="no-data">
                    <i class="fas fa-inbox"></i>
                    <p>æš‚æ— è½¦ç¥¨è®¢å•</p>
                </div>
            </section>

            <!-- å€™è¡¥é˜Ÿåˆ— -->
            <section class="card wait-queue">
                <h2><i class="fas fa-list-ol"></i> æˆ‘çš„å€™è¡¥è®¢å•</h2>
                <div v-if="myWaitOrders.length > 0" class="orders-list">
                    <div 
                        v-for="order in myWaitOrders" 
                        :key="order.order_id"
                        class="order-item"
                        :class="'status-' + order.status"
                    >
                        <div class="order-header">
                            <span class="order-id">{{ order.order_id }}</span>
                            <span class="order-status" :class="'badge-' + order.status">
                                {{ getStatusText(order.status) }}
                            </span>
                        </div>
                        <div class="order-body">
                            <div class="order-info">
                                <p><i class="fas fa-user"></i> {{ order.passenger.name }} ({{ order.passenger.id }})</p>
                                <p><i class="fas fa-train"></i> {{ order.train_id }} - {{ order.date }}</p>
                                <p><i class="fas fa-clock"></i> åˆ›å»ºæ—¶é—´: {{ formatTime(order.create_time) }}</p>
                            </div>
                            <div class="order-position">
                                <div class="position-number">{{ order.position }}</div>
                                <div class="position-label">æ’é˜Ÿä½ç½®</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else class="no-data">
                    <i class="fas fa-inbox"></i>
                    <p>æš‚æ— å€™è¡¥è®¢å•</p>
                </div>
            </section>

            <!-- æ¶ˆæ¯é€šçŸ¥ -->
            <section class="card messages">
                <h2><i class="fas fa-bell"></i> ç³»ç»Ÿæ¶ˆæ¯</h2>
                <div class="messages-list">
                    <div 
                        v-for="(msg, index) in messages" 
                        :key="index"
                        class="message-item"
                        :class="'message-' + msg.type"
                    >
                        <i class="fas" :class="getMessageIcon(msg.type)"></i>
                        <span>{{ msg.text }}</span>
                        <span class="message-time">{{ msg.time }}</span>
                    </div>
                </div>
                <div v-if="messages.length === 0" class="no-data">
                    <p>æš‚æ— æ¶ˆæ¯</p>
                </div>
            </section>
        </main>

        <!-- é¡µè„š -->
        <footer class="footer">
            <div class="container">
                <p>Â© 2024 ç«è½¦ç¥¨å€™è¡¥è´­ç¥¨ç³»ç»Ÿ | åŸºäº Vue 3 + WebSocket</p>
            </div>
        </footer>

        <!-- ç¡®è®¤å¯¹è¯æ¡† -->
        <div v-if="showConfirmDialog" class="modal-overlay" @click="closeConfirmDialog">
            <div class="modal" @click.stop>
                <div class="modal-header">
                    <h3>{{ confirmDialog.title }}</h3>
                    <button class="close-btn" @click="closeConfirmDialog">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>{{ confirmDialog.message }}</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="closeConfirmDialog">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="confirmAction">ç¡®è®¤</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
