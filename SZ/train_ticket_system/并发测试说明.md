# 并发抢票测试功能说明

## 🎯 功能概述

新增了**并发抢票测试**功能，可以模拟多个客户端同时抢票，真实反映票数变化和候补队列情况。

## ✨ 核心特性

### 1. 票数持久化
- ✅ 票数不再随机变化
- ✅ 刷新余票时保持已售票数不变
- ✅ 只有在购票、退票、重置时才会改变

### 2. 并发抢票
- ✅ 可设置1-200个并发客户端
- ✅ 模拟真实的多人抢票场景
- ✅ 自动统计购票成功和候补人数

### 3. 测试功能
- ✅ 一键售罄：快速将余票设为0
- ✅ 重置系统：清空所有数据重新开始
- ✅ 实时统计：显示抢票结果

## 📖 使用教程

### 场景1：测试正常抢票

```
1. 打开页面，余票显示 0/100

2. 点击"重置系统"，余票恢复为 100/100

3. 在"并发客户端数量"输入：50

4. 点击"开始并发抢票"

5. 观察结果：
   - 成功购票: 50 张
   - 当前余票: 50/100
   
6. 点击"刷新余票"
   - 余票仍然是 50/100（不会变化）
```

### 场景2：测试候补功能

```
1. 点击"重置系统"

2. 在"并发客户端数量"输入：120
   （超过总票数100张）

3. 点击"开始并发抢票"

4. 观察结果：
   - ✅ 成功购票: 100 张
   - ⏰ 加入候补: 20 人
   - 🎫 当前余票: 0/100
   
5. 在"我的候补订单"区域查看20个候补订单
   - 显示排队位置：第1位、第2位...第20位
   - 状态：等待中
```

### 场景3：测试候补兑现

```
1. 先执行场景2，让20人进入候补

2. 点击"退票"按钮

3. 观察变化：
   - 余票: 0/100（候补第1位自动购票）
   - 候补订单第1位状态变为"已兑现"
   - 其他候补订单位置前移
   
4. 再次点击"退票"
   - 候补第2位（现在是第1位）自动购票
   - 继续观察队列变化
```

### 场景4：测试售罄后候补

```
1. 点击"重置系统"

2. 点击"测试售罄（余票归零）"
   - 余票立即变为 0/100

3. 在"并发客户端数量"输入：30

4. 点击"开始并发抢票"

5. 观察结果：
   - ✅ 成功购票: 0 张（没有余票）
   - ⏰ 加入候补: 30 人（全部进入候补）
   
6. 查看候补订单列表
   - 30个订单，排队位置1-30
```

## 🎮 操作按钮说明

### 车次信息区域

| 按钮 | 功能 | 说明 |
|------|------|------|
| 🔄 刷新余票 | 刷新显示 | 保持已售票数不变 |
| 🧪 测试售罄 | 余票归零 | 快速测试候补功能 |
| 🔁 重置系统 | 清空数据 | 恢复初始状态 |

### 并发测试区域

| 元素 | 功能 | 说明 |
|------|------|------|
| 并发客户端数量 | 输入框 | 1-200，默认10 |
| 🚀 开始并发抢票 | 按钮 | 模拟多人抢票 |

### 操作面板

| 按钮 | 功能 | 说明 |
|------|------|------|
| 🎫 购买车票 | 单人购票 | 需填写乘客信息 |
| ⏰ 加入候补 | 单人候补 | 需填写乘客信息 |
| ↩️ 退票 | 退票操作 | 触发候补兑现 |

## 📊 测试数据示例

### 示例1：50人抢100张票

```
输入: 50个并发客户端
结果:
  ✅ 成功购票: 50 张
  ⏰ 加入候补: 0 人
  🎫 当前余票: 50/100
```

### 示例2：150人抢100张票

```
输入: 150个并发客户端
结果:
  ✅ 成功购票: 100 张
  ⏰ 加入候补: 50 人
  🎫 当前余票: 0/100
```

### 示例3：退票后候补兑现

```
初始状态:
  余票: 0/100
  候补队列: 50人

操作: 点击"退票" 1次
结果:
  余票: 0/100（候补第1位自动购票）
  候补队列: 49人（第1位已兑现）
  
操作: 点击"退票" 5次
结果:
  余票: 0/100
  候补队列: 44人（前5位已兑现）
```

## 🔍 观察要点

### 1. 票数一致性
- ✅ 刷新余票时，已售票数保持不变
- ✅ 只有购票、退票、重置会改变票数
- ✅ 并发抢票后，票数准确反映实际售出数量

### 2. 候补队列
- ✅ 无票时自动加入候补
- ✅ 显示准确的排队位置
- ✅ 退票时自动为第1位购票
- ✅ 其他订单位置自动前移

### 3. 并发统计
- ✅ 显示成功购票数量
- ✅ 显示加入候补数量
- ✅ 显示当前余票情况

## 💡 使用技巧

### 技巧1：快速测试候补
```
1. 点击"测试售罄"
2. 输入并发数量：20
3. 点击"开始并发抢票"
4. 立即看到20人进入候补
```

### 技巧2：观察候补兑现
```
1. 先让多人进入候补
2. 连续点击"退票"按钮
3. 观察候补订单状态变化
4. 观察排队位置变化
```

### 技巧3：重新开始测试
```
1. 点击"重置系统"
2. 所有数据清空
3. 余票恢复100张
4. 可以重新测试
```

### 技巧4：测试不同规模
```
小规模: 10个客户端
中规模: 50个客户端
大规模: 150个客户端
超大规模: 200个客户端
```

## 🎯 测试建议

### 基础测试
1. ✅ 测试正常购票（客户端数 < 余票数）
2. ✅ 测试候补功能（客户端数 > 余票数）
3. ✅ 测试票数持久化（刷新后票数不变）

### 进阶测试
4. ✅ 测试候补兑现（退票触发自动购票）
5. ✅ 测试队列位置更新
6. ✅ 测试大规模并发（100+客户端）

### 压力测试
7. ✅ 测试200个客户端并发
8. ✅ 连续多次并发抢票
9. ✅ 快速切换售罄和重置

## ⚠️ 注意事项

1. **并发数量限制**
   - 最小: 1个客户端
   - 最大: 200个客户端
   - 推荐: 10-150个

2. **性能考虑**
   - 客户端数量过多可能导致页面卡顿
   - 建议分批测试

3. **数据持久化**
   - 当前数据仅在前端存储
   - 刷新页面会丢失数据
   - 使用"重置系统"清空数据

4. **候补订单**
   - 订单会累积在列表中
   - 使用"重置系统"清空
   - 最多显示所有候补订单

## 🎉 功能亮点

✅ **真实模拟** - 准确模拟多人抢票场景  
✅ **数据持久** - 票数不会随机变化  
✅ **自动统计** - 实时显示抢票结果  
✅ **候补兑现** - 自动触发候补购票  
✅ **位置更新** - 实时更新排队位置  
✅ **一键重置** - 快速重新开始测试  

## 📝 总结

这个并发抢票测试功能完美解决了：
1. ✅ 票数随机变化的问题
2. ✅ 无法测试并发场景的问题
3. ✅ 候补功能难以演示的问题

现在可以：
- 🎯 真实模拟多人抢票
- 📊 准确统计抢票结果
- 🔄 观察候补队列变化
- 🧪 快速测试各种场景

**开始使用吧！** 🚀
